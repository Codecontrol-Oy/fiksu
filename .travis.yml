language: node_js
sudo: required
services:
- docker
addons:
  ssh_known_hosts:
  - fiksu.codecontrol.fi
env:
  global:
    - secure: fGj4wT7Aju1YSJLW+D0V0/NhrmqmhU3tbodFDuRoq22eW/paDjTo/psCcWwUJQBtx/IB91B2BWBfKC6sz3lBetWC9j3EvJL3tYD0g2hQe/17QZYZvsPOc2jizTIgSp1zLmER2RT8jQUMA7HM+APtlOWSxWhs71yKU0VhMxNkjnZnIqPWP1BYHgGXLOWz+zF7p1HtjTtSWKh/pAqavBXHIXM1alM9S/2u5VTNOoOzSUhG6u9lyAJ+OVMZ5esRtRzqpByj9fIRk6tr0IKsSLU5umxNc0v47ti7caMSdE8gkXQKhBAcUdkFyXTPMvIDMAS084gleWWCI3MhGRDnwZ2AbTe6IvrwA8/yEdic7vT0M9IFjdiGTp3BrYV7a0K9MVt74WHQo0dYbff94W/iFr/9DfMt7LOHUN7M6wkXNZ1LeVaw2HLqI2h68MjIzd5JKCiQplWxZigJmjHj3Om7Dd5VqXhbEs31NHbX7SAHximQ/qVLKqt2UaCpvndWYbwNgoBFCku+AcN7rA6o1lCDnOsxYRVLoz+Pf1f3mclulLtQb0qOlRyhCyhVZq01iWiW3cFH8nIVCO3iNPpyk4ikPqHJA9j/ew88l2/KceDxDAV1wldXBWWbM03YhVb21yYLsdmT7xRHTEiTC1dndXIJoJw0yzRrye8EwvRC0LsZSunnsPs=
    - secure: uXDRG/V2rDgNh073hrEyYiaV/fZrt9GFfe0DJUtBv4+ykjqL7Rg+Frma+rzTayoX+gZyVcrIAV8+xFqArBbSqIaIlaB1ksbFWB9ADwejeSrxPN/pnOcjlOzDPaNYotq1N60Kt/i6tPLwofx+Lt/Rd9e+fjlQqjylloTuYvuV1id/OUGGXx1tHv//gK7MOhufyMO28fYNMW1cngNLrmu0Vwser2kiUmqbCg2EgKXcZ5QuIs36KGKnU+Md5FiMH7e9M/BzkGdra8j5RyQki5TNWlo7IP3l/RVc7NKVuDz3Atf2C0pBMD0Gb77OdN63lzff3HrgulzdRAww2WmlSDlVxiNzldQNs6YSIrXG7WsbrGozJhRonSX/UgPahDetvTuIjihTqMXZUuB1/sVL7B4kD9eyMpbVt9iNDMWDTl5GXz5Q79SRZvuKtBaD0Y+mEdSUBd+tJTTh46kJ228noVFgSTmOCLoMGSE77yqV1VAqyM9uL2G8sB7om1+iV/89QCmFQ+/cGfnYzM0fevLUlW/gh/yafoxfwUCtuPsgIrZR+C/IMnZjh1NaYO4CDwv4+RSLfZkxG1vBmuFHPNOOG46Y0l9nCUbe8uUmsFJjXLOtPWzbmVrQcQGz+xOfSl2y4s/kxKYaXIU+2Q9V5nxorLRPkFLHA0fDlIJaaWtlOQEV7O4=
    - secure: ubGTsK4+N8ilBz53f3jg6O1xC9MpoM0CPz+H9ePYFgS6J2Iu7FspV5dKXhVpPk2UxSElbZex8bixJj5sC42UmmGvHgQO14vECLafEJTYJNwbkY7tLNc1NYFClpH0by4bPtir5SlY/2nzgktrCgpoM4/rSUgd51hd95tfMwxETLNdkFxMovkewFcdL/s92qXheUOEC4yM3p0CU/1OFYXF0rcrdvODDTKkMVhRnBZhUTWXUZ0Dahi4umWZGUKKQmCqymaZy8SbAzor+1CQdXJ61WKdQlyYI8QM+D8AD/SO0SDoflZQXy6VY0zCDYaZEcUIQr7eWG59jXb1UMJULBhuzCd4yab50CndhNOwhnnWlpRUEozwVbdwy/+MN3zLbj7MrZx/rrVLgq1hwgY8X+uO0LOO4ud4zkj+ig9VzmuOG0xVZSDtnxgv/oa8R/T7ULq/pIWVlSZmZHBKMjwELsB0vuJQ6wZPhA9heI0q1wnJI0RjD9gIhDs/2a4OWtdCTSk1tZ3LHNEjAy5JKV2qoBfWztbnIgTuWIlxfUCB2k2t+xVyNd9p8YZNj64G/TsQcP/DPuwYwu2BYqsZ+dYgiz06cuo66gYTQfbcmAE1L/bnjbgWj13O4rJPOQrQfUdQcVvFFcnzB3HzY4shptvjBSVPEJo5u55c28CKb21qRjfnAho=
node_js:
- 11.10.0
before_install:
- chmod a+x deploy.sh
- chmod a+x docker_push.sh
- openssl aes-256-cbc -K $encrypted_53365c26be73_key -iv $encrypted_53365c26be73_iv -in deploy_rsa.enc -out /tmp/deploy_rsa -d
- eval "$(ssh-agent -s)"
- chmod 600 /tmp/deploy_rsa
- ssh-add /tmp/deploy_rsa
install:
- cd $TRAVIS_BUILD_DIR/frontend && npm install
- cd $TRAVIS_BUILD_DIR/backend && npm install
script:
- echo "skipping tests for now"
after_success:
- cd $TRAVIS_BUILD_DIR/frontend && docker build -t codecontrol/fiksu-frontend:dev-"$TRAVIS_BUILD_NUMBER" . --label "version=$TRAVIS_BUILD_NUMBER"
  --label "commitMessage=$TRAVIS_COMMIT_MESSAGE" --label "commit=$TRAVIS_COMMIT"
- cd $TRAVIS_BUILD_DIR/backend && docker build -t codecontrol/fiksu-backend:dev-"$TRAVIS_BUILD_NUMBER" . --label "version=$TRAVIS_BUILD_NUMBER"
  --label "commitMessage=$TRAVIS_COMMIT_MESSAGE" --label "commit=$TRAVIS_COMMIT"
- cd $TRAVIS_BUILD_DIR && ./docker_push.sh
deploy:
  - provider: script
    script: "./deploy.sh"
    on:
      branch: master
