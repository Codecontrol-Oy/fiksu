language: node_js
sudo: required
services:
- docker
addons:
  ssh_known_hosts:
  - fiksu.codecontrol.fi
env:
  global:
    - secure: fGj4wT7Aju1YSJLW+D0V0/NhrmqmhU3tbodFDuRoq22eW/paDjTo/psCcWwUJQBtx/IB91B2BWBfKC6sz3lBetWC9j3EvJL3tYD0g2hQe/17QZYZvsPOc2jizTIgSp1zLmER2RT8jQUMA7HM+APtlOWSxWhs71yKU0VhMxNkjnZnIqPWP1BYHgGXLOWz+zF7p1HtjTtSWKh/pAqavBXHIXM1alM9S/2u5VTNOoOzSUhG6u9lyAJ+OVMZ5esRtRzqpByj9fIRk6tr0IKsSLU5umxNc0v47ti7caMSdE8gkXQKhBAcUdkFyXTPMvIDMAS084gleWWCI3MhGRDnwZ2AbTe6IvrwA8/yEdic7vT0M9IFjdiGTp3BrYV7a0K9MVt74WHQo0dYbff94W/iFr/9DfMt7LOHUN7M6wkXNZ1LeVaw2HLqI2h68MjIzd5JKCiQplWxZigJmjHj3Om7Dd5VqXhbEs31NHbX7SAHximQ/qVLKqt2UaCpvndWYbwNgoBFCku+AcN7rA6o1lCDnOsxYRVLoz+Pf1f3mclulLtQb0qOlRyhCyhVZq01iWiW3cFH8nIVCO3iNPpyk4ikPqHJA9j/ew88l2/KceDxDAV1wldXBWWbM03YhVb21yYLsdmT7xRHTEiTC1dndXIJoJw0yzRrye8EwvRC0LsZSunnsPs=
    - secure: KghIinOfpFl6augvYtOTUF4GrQzY0X8eezXh30FPxbz4z3FVDR8zhOuzuYHwAF/iM9Ajh2fOfTqHSMbFudHEpYFoyPN1GdpPliT22uItK4HQnLAxM6wypQm3AD/okeQce5fA7b87FTHOZGchgOurRYK9ONYULhKdJYTPlq+nhUMX6wnuFRkqiQjrXkvCZjv8USYXAjTg5hxRk4EmUZIiduyghZjmBwTZ0ESsJe7njxAMnNDgMVVIRdWRrqgdKIeC51JS3HUhaRngytIk9B0cQW6uTrCV5RwMAZGPdFkba4Wx/CZfZkPTOyK+0gdvk97j/2u0Q1hrV+Vq+ziogeh9wYWxt8sFSE8CvQZoPvtbKtAaO/++bQ4LfEo3tfZLkULjnld60Z020WE9+IRr44AVgCL6bLRkkVQTNW8JaYtSAjEQp2aJAoH03x6K+kdZEnXnoAA9pz+mEfbvp2GnkcgJROHRSj70PwNrY+9m96Q7xaCaBZcYYl1tHe3AQHEIjwloZ9r1IWoY3E6e35buPCDbXNz6gRBr3dvrvu4teki+nYJzaFlyIWyIrmboal1o4uK/RyqEVILsZllG90xBFpLZLjriqsAgitdZoeClGVZLCKzoly0YCkX2B1FCIeGfwLrxACePJcOS6b9V6Qk2KU5XPNrvId5Lc/dJBbDku+p6m+I=
    - secure: D0c48mtM3RCubeEqtq55witL4FsluwssiD28MBVeVm/8lzA0WQtBEkSh6TmvOHRRGDR+q4ymRJwXWLznWTvEVtvAGJNjWO+FWcmKVi6FzSVpXfEbuNwlcHXgAHgtBdN0UlD1aZYxHhz7uAXHvFHUqecWRaYRFRyh0Ct+ySluA4XFSzxxGQj3WZaeV09FgxtE0szBp8fxYwP/l+58L/GpEswpvYiQ3Z5hY+EK+9uZDBI0iteyf5YefH9WV6w2iH0bBN2qZDPg7CZFHx8abPdvA2gmKRkmRVW6NK23w/cf9iBCY2T9MTM3A76CjY+bZ0DXk3Ij7/YJicr5Tza70DXKw0kEdQZ5DSumXDw/5e4uz1s9T+feU2eDHiKmfbg+9RCCSzdQI79QyJ5lfP51zmq2lW8sWG3F26tbxN7OAj5ZfXtBlEjfbOKSapHkwjKUuZxf2qfa8yx8lIiUOvYJedVEc2rs0KnLFPBOXcm6gegC0rj+iyTVtliURJJtpUIZo2M03Iirr0H31nfC3vKeGCcHq5CTSe41e181atqhDvZkntMUvRwRJ88OuOgjncUYHvODPghCnlTcoTAmHktnnuNP6izHgRkujVN3G0Sn5tXCV5YBX1w9S6TVpmOBnxei+EYMxdTNsF3FZPZXhf71k2+H2Wlc8hi/5fNEZP2pSoeGJIw=
node_js:
- 11.10.0
before_install:
- chmod a+x deploy.sh
- chmod a+x docker_push.sh
- openssl aes-256-cbc -K $encrypted_53365c26be73_key -iv $encrypted_53365c26be73_iv -in deploy_rsa.enc -out /tmp/deploy_rsa -d
- eval "$(ssh-agent -s)"
- chmod 600 /tmp/deploy_rsa
- ssh-add /tmp/deploy_rsa
install:
- cd $TRAVIS_BUILD_DIR/frontend && npm install
- cd $TRAVIS_BUILD_DIR/backend && npm install
script:
- echo "skipping tests for now"
after_success:
- cd $TRAVIS_BUILD_DIR/frontend && docker build -t codecontrol/fiksu-frontend:dev-"$TRAVIS_BUILD_NUMBER" . --label "version=$TRAVIS_BUILD_NUMBER"
  --label "commitMessage=$TRAVIS_COMMIT_MESSAGE" --label "commit=$TRAVIS_COMMIT"
- cd $TRAVIS_BUILD_DIR/backend && docker build -t codecontrol/fiksu-backend:dev-"$TRAVIS_BUILD_NUMBER" . --label "version=$TRAVIS_BUILD_NUMBER"
  --label "commitMessage=$TRAVIS_COMMIT_MESSAGE" --label "commit=$TRAVIS_COMMIT"
- cd $TRAVIS_BUILD_DIR && ./docker_push.sh
deploy:
  - provider: script
    script: "./deploy.sh"
    skip_cleanup: true
    on:
      branch: master
